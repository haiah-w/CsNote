# MQ解决什么问题

1、**系统功能解耦**

系统间非强依赖的功能模块，通过消息队列进行解耦，降低系统复杂度；

2、**流量控制**

流量的削峰填谷，根据系统性能，调节流量，避免大流量导致服务不可用；

# MQ引入了什么新的问题

1、**系统功能解耦：系统间的数据一致性问题**

- 消息发送、消费的幂等问题；
- 消息丢失问题；

2、**流量控制：消费端处理慢，消息积压问题**

- 消息积压问题；





# 消费幂等

消息幂等，就是保证不重复消费；







# 保证消息可靠传输

消息在生产到消费，一共经历三个部分：生产者、服务端、消费端

可能存在丢失的场景存在三个：

1、生产者发送消息到消息队列时丢失；

2、消息队列未能持久化消息，宕机丢失；

3、消息消费时，未能消费成功，MQ清除消息或者宕机丢失；

因此解决这三个问题，就从三个方面去考虑：

1、**保证生产端可靠投递**

采用同步方式发送消息，确保收到MQ的成功响应，保证投递成功；

2、**保证MQ端的消息副本同步、持久化**

MQ在收到消息后，保证消息同步到各个MQ副本上，再响应生产端；副本同步成功已经可以保证消息不丢失了；

如果要完全保证，还需要持久化消息，但是会拉低性能；

3、**消费端保证消费完成，MQ才会清除此消息**

当消费端，消费完成，应当响应MQ，去进行对应消息的清理；



# 消息挤压问题

通常是消费端的消费能力不足；










